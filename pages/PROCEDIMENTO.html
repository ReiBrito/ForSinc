<!DOCTYPE html>
<html lang="pt-br">
  <head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Procedimento</title>
  
    <!---Custom CSS File--->
    <link rel="stylesheet" href="style.css" />
  
 </head>

 <section class="container">
    <header>Procedimento</header>
    <form id="myForm" action="#" class="form">

	  		<!---1º linha--->
		<div class="column">
          <div class="input-box">
			<label for="cnpjUG">CNPJ da UG:</label>
			<input type="text" id="cnpjUG" name="cnpjUG" maxlength="14" required>
		  </div>
          <div class="input-box">
			<label for="idContratacao">ID Contratação:</label>
			<input type="text" id="idContratacao" name="idContratacao" required>
          </div>
        </div>
	  		<!---2º linha--->
		<div class="column">
          <div class="input-box">
			<label for="numeroProcesso">Número do Processo:</label>
			<input type="text" id="numeroProcesso" name="numeroProcesso" required>
		  </div>
          <div class="input-box">
			<label for="anoProcesso">Ano do Processo:</label>
			<input type="text" id="anoProcesso" name="anoProcesso" maxlength="4" required>
          </div>
        </div>
	  		<!---3º linha--->
		<div class="column">
          <div class="input-box">
			<label for="numeroProcedimento">Número do Procedimento:</label>
			<input type="number" id="numeroProcedimento" name="numeroProcedimento" required>
		  </div>
          <div class="input-box">
			<label for="anoProcedimento">Ano do Procedimento:</label>
			<input type="text" id="anoProcedimento" name="anoProcedimento" maxlength="4" required>
          </div>
        </div>
	  		<!---4º linha--->
		<div class="column">
          <div class="input-box">
			<label for="dataPublicacao">Data de Publicação:</label>
			<input type="date" id="dataPublicacao" name="dataPublicacao" required>
		  </div>
          <div class="input-box">
			<label for="numeroLei">Número da Lei:</label>
			<input type="number" id="numeroLei" name="numeroLei" required>
          </div>
        </div>
	  		<!---5º linha--->
		<div class="column">
          <div class="input-box">
			<label for="anoLei">Ano da Lei:</label>
			<input type="text" id="anoLei" name="anoLei" maxlength="4" required>
		  </div>
          <div class="input-box">
			<label for="codProcedimento">Código do Procedimento:</label>
			<input type="text" id="codProcedimento" name="codProcedimento" required>
          </div>
        </div>
	  		<!---6º linha--->
		<div class="column">
		  <div class="input-box">
			<label for="criterio">Critério:</label>
			<div class="select-box">
				<select type="number" id="criterio" name="criterio" required>
				  <option value="">Selecione uma opção</option>
				  <option value="Menor Preço">Menor Preço</option>
				  <option value="Melhor Técnica">Melhor Técnica</option>
				  <option value="Técnica e Preço">Técnica e Preço</option>
				  <option value="Maior Desconto">Maior Desconto</option>
				  <option value="Maior Oferta">Maior Oferta</option>
				</select>
			</div>
          </div>
		  <div class="input-box">
			<label for="sistemaPregao">Sistema de Pregão:</label>
			<div class="select-box">
				<select type="number" id="sistemaPregao" name="sistemaPregao" required>
				  <option value="">Selecione uma opção</option>
				  <option value="Menor Preço">Menor Preço</option>
				  <option value="Melhor Técnica">Melhor Técnica</option>
				</select>
			</div>
          </div>
        </div>
	  		<!---7º linha--->
		<div class="column">
		  <div class="input-box">
			<label for="finalidade">Finalidade:</label>
			<div class="select-box">
				<select type="number" id="finalidade" name="finalidade" required>
				  <option value="">Selecione uma opção</option>
				  <option value="Aquisição de Bens">Aquisição de Bens</option>
				  <option value="Contratação de Serviços">Contratação de Serviços</option>
				  <option value="Obras e Serviços de Engenharia">Obras e Serviços de Engenharia</option>
				  <option value="Alienação de Bens">Alienação de Bens</option>
				</select>
			</div>
		  </div>
          <div class="input-box">
			<label for="dataAdesao">Data de Adesão:</label>
			<input type="date" id="dataAdesao" name="dataAdesao" required>
          </div>
        </div>
	  		<!---8º linha--->
		<div class="column">
		  <div class="input-box">
			<label for="regimeExecucao">Regime de Execução:</label>
			<div class="select-box">
				<select type="number" id="regimeExecucao" name="regimeExecucao" required>
				  <option value="">Selecione uma opção</option>
				  <option value="Empreitada por Preço Global">Empreitada por Preço Global</option>
				  <option value="Empreitada por Preço Unitário">Empreitada por Preço Unitário</option>
				  <option value="Tarefa">Tarefa</option>
				  <option value="Empreitada Integral">Empreitada Integral</option>
				</select>
			</div>
		  </div>
		</div> 
		
		<div class="column">  
          <div class="input-box">
			<label for="objeto">Objeto:</label>
			<textarea id="objeto" name="objeto" required></textarea>
          </div>
        </div>
	  		<!---9º linha--->
		<div class="column">
          <div class="input-box">
			<label for="valorEstimado">Valor Estimado:</label>
			<input type="number" id="valorEstimado" name="valorEstimado" step="0.01" required>
		  </div>
          <div class="input-box">
			<label for="dataSessao">Data da Sessão:</label>
			<input type="date" id="dataSessao" name="dataSessao" required>
          </div>
        </div>
	  		<!---10º linha--->
		<div class="column">
         
          <div class="input-box">
			<label for="cpfAutoridade">CPF da Autoridade:</label>
			<input type="text" id="cpfAutoridade" name="cpfAutoridade" maxlength="11" required>
          </div>
        </div>
			<!---11º linha--->
	    <div class="column">
		  <div class="input-box">
			<button type="submit">Gerar Arquivo</button>
		  </div>
		</div>
		
		 <input type="file" id="importJson" accept=".json">
			
    </form>
 </section>

 <script>
    document.getElementById('myForm').addEventListener('submit', function(event) {
      event.preventDefault();

      // Obtém os valores do formulário
      var cnpjUG = document.getElementById('cnpjUG').value;
      var idContratacao = document.getElementById('idContratacao').value;
      var numeroProcesso = document.getElementById('numeroProcesso').value;
      var anoProcesso = parseInt(document.getElementById('anoProcesso').value);
      var numeroProcedimento = parseInt(document.getElementById('numeroProcedimento').value);
      var anoProcedimento = parseInt(document.getElementById('anoProcedimento').value);
      var dataPublicacao = document.getElementById('dataPublicacao').value;
      var numeroLei = parseInt(document.getElementById('numeroLei').value);
      var anoLei = parseInt(document.getElementById('anoLei').value);
      var codProcedimento = document.getElementById('codProcedimento').value;
	  var criterio = document.getElementById('criterio').value;
      var sistemaPregao = document.getElementById('sistemaPregao').value;
      var finalidade = document.getElementById('finalidade').value;
      var dataAdesao = document.getElementById('dataAdesao').value;
      var regimeExecucao = document.getElementById('regimeExecucao').value;
      var objeto = document.getElementById('objeto').value;
      var valorEstimado = parseFloat(document.getElementById('valorEstimado').value);
      var dataSessao = document.getElementById('dataSessao').value;
      var cpfAutoridade = document.getElementById('cpfAutoridade').value;

      // Obtém o JSON existente
      var jsonData = [
        
      ];

      // Cria um objeto com os valores do formulário
      var newEntry = {
        "cnpj_ug": cnpjUG,
        "id_contratacao": idContratacao,
        "numero_processo": numeroProcesso,
        "ano_processo": anoProcesso,
        "numero_procedimento": numeroProcedimento,
        "ano_procedimento": anoProcedimento,
        "data_publicacao": dataPublicacao,
        "numero_lei": numeroLei,
        "ano_lei": anoLei,
        "cod_procedimento": codProcedimento,
        "criterio": criterio,
        "sistema_pregao": sistemaPregao,
        "finalidade": finalidade,
        "data_adesao": dataAdesao,
        "regime_execucao": regimeExecucao,
        "objeto": objeto,
        "valor_estimado": valorEstimado,
        "data_sessao": dataSessao,
        "cpf_autoridade": cpfAutoridade
      };

     // Adiciona o novo objeto ao array existente
      jsonData.push(newEntry);

      // Converte o array para JSON
      var updatedJsonData = JSON.stringify(jsonData);

      // Cria um objeto Blob com os dados JSON
      var blob = new Blob([updatedJsonData], {type: 'application/json'});

      // Cria um link para download do arquivo
      var downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(blob);
      downloadLink.download = 'procedimento.json';
      downloadLink.click();
    });
	
	// Evento de carregamento do arquivo JSON
    document.getElementById('importJson').addEventListener('change', function(event) {
      var file = event.target.files[0];
      var reader = new FileReader();

      reader.onload = function(e) {
        try {
          var jsonData = JSON.parse(e.target.result);
          var lastEntry = jsonData[jsonData.length - 1];
 
		
          // Preenche os campos do formulário com os dados do último objeto do arquivo JSON
          document.getElementById('cnpjUG').value = lastEntry.cnpj_ug;
		  document.getElementById('idContratacao').value = lastEntry.numero_processo;
          document.getElementById('numeroProcesso').value = lastEntry.id_contrato;
          document.getElementById('anoProcesso').value = lastEntry.ano_processo;
          document.getElementById('numeroProcedimento').value = lastEntry.numero_procedimento;
		  document.getElementById('anoProcedimento').value = lastEntry.ano_procedimento;
		  document.getElementById('dataPublicacao').value = lastEntry.data_publicacao;
		  document.getElementById('numeroLei').value = lastEntry.numero_lei;
          document.getElementById('anoLei').value = lastEntry.ano_lei;
          document.getElementById('codProcedimento').value = lastEntry.cod_procedimento;		  
		  document.getElementById('criterio').value = lastEntry.criterio;
          document.getElementById('sistemaPregao').value = lastEntry.sistema_pregao; 
		  document.getElementById('finalidade').value = lastEntry.finalidade;
          document.getElementById('dataAdesao').value = lastEntry.data_adesao;
		  document.getElementById('regimeExecucao').value = lastEntry.regime_execucao;		  
		  document.getElementById('objeto').value = lastEntry.objeto;
		  document.getElementById('valorEstimado').value = lastEntry.valor_estimado;
          document.getElementById('dataSessao').value = lastEntry.data_sessao;
		  document.getElementById('cpfAutoridade').value = lastEntry.cpf_autoridade;
		  
          alert('Arquivo JSON importado com sucesso!');
        } catch (error) {
          alert('Erro ao importar o arquivo JSON.');
        }
      };

      reader.readAsText(file);
    });
	
  </script>
</body>
</html>